<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<!-- base data saved from url=(0046)http://tespedia.ru/special/skyrim_alchemy_tool -->
<html xmlns="http://www.w3.org/1999/xhtml" lang="ru" id="js">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<title>Калькулятор Алхимии для Скайрима</title>

<style type="text/css">
body {
	font-family:sans-serif, Arial, Tahoma;
	line-height:1.6em;
	width:100%;
	height:100%;
	color:#4a4a4a;
	background-color:#89A;
	border:none;
}
body, th, td, p, a { font-size:13px; }
.mobile .hide-on-mobile { display:none; }
.mobile body:not(.p-mode) .case-on-mobile { display:none; }

input { font-size:1em; }
input[type=checkbox] { vertical-align: middle; height: 1em; width: .9em; margin: .15em; cursor:pointer; }

a {
	/*font-size:1em;*/
	/*color:#1F68A2;*/
	text-decoration:none;
}
a:hover { text-decoration:underline; }
a img { border:none; }
a, a:hover, a:visited { color:#444; }

h3 {
	color:#AF9F89;
	font-style:italic;
	font-size:1.2em;
	line-height:normal;
	margin: 0 0 .5em 0;
	font-weight:bold;
	padding:0;
	overflow:hidden;
}
h3 a, h3:hover a{text-decoration:none;}

label { cursor:pointer; }
</style>

<style type="text/css">
html { width:100%; }
html, body {
	height:100%;
	margin:0;padding:0;background: #6a7f94;
	background: -moz-linear-gradient(top,#6a7f94 0,#CDD5DC 500px);
	background: -webkit-linear-gradient(#6a7f94 0,#CDD5DC 500px);
	background: -ms-linear-gradient(top,#6a7f94 0,#CDD5DC 500px);
	background: linear-gradient(top,#6a7f94 0,#CDD5DC 500px);
	background-color: #CDD5DC;
	background-repeat: no-repeat;margin: 0;
}
div#wrapper {min-width:320px; max-width:1280px; margin:auto;}
#maincolumn {width:calc(100% - 3em); position:relative; text-align:left; margin-bottom:30px; padding:1.5em; min-height:400px;}
.mobile #maincolumn {width:calc(100% - 1em); padding:.5em;}
#area {position:relative; background:#fff; padding:0; overflow:hidden; z-index:100; padding:170px 0 15px 0;}
#wrapper_r {position:relative;}

.negative {background-color: #FDD !important;}
.positive {background-color: #DFD !important;}

table.ingredients tbody td>a {
	display: inline-block;
	vertical-align: middle;
	white-space: nowrap;
	overflow:hidden;
}
.mobile table.ingredients tbody td>a {white-space: normal; line-height: 1.2;}

th.name_column {width: 17%;}
.mobile th.name_column {width: 30%;}
table.filter-edit-mode td.name_column>a {margin-left: .5em;}
td.name_column {white-space: nowrap;}
th.effect_column {/*width: 20em;*/}
#alch_div table td.effects {padding:0 !important;}

div.effect { position: relative; display: inline-block; padding: calc(.5em - 1px); width: calc(25% + 1px - 2*.5em); white-space: nowrap; overflow: hidden; border-left: 1px solid #ccc; }
.mobile div.effect { line-height:.9; padding: 7px; height: 1.6em; width: calc(50% - 1px - 2*7px); white-space: normal; }
.mobile div.effect { height: .8em; width: calc(100% - 1px - 2*7px); }
.mobile div.effect { border-left: none; border-right: 1px solid #ccc; border-top: 1px solid #ccc; }
div.effect:first-child { border-left: none; }

table.ingredients .num_column {width: 2em; text-align: center;}
.mobile table.ingredients .num_column {width: 1.5em;}

#alch_div table td {position: relative;}
.diveye {position: absolute; top: 2px; right: 2px; padding: .5em; height: 1.3em; background-color: #f0f0f0; cursor:pointer;}
.mobile .diveye {top: 0; right: 0; padding: 10px;}
.diveye img {position: relative; top: -2px; height: 1.7em;}
.effectvprice {position: absolute; bottom: 0; left: 1px; width: 3px; background-color: #EAAF00;}

.effect_warning a {color:#FF0080;}
td.best_price, .best_price a {color:#aaa; font-size:.9em; cursor:pointer}

#filter_div {margin: 1.2em 0 1em 0;}
.highlighted {font-weight: bolder;}
#alch_div table td a.highlighted {color: #8000FF;}
#filter_div p, #potions_div p, #effects_filter a, #filtered_div p {/*font-size:1em;*/}

table.tablesorter thead tr .header {
	background-image: url(header_bg.gif);
	background-repeat: no-repeat;
	background-position: center right;
	cursor: pointer;
}
table.tablesorter thead tr .headerSortUp {
	background-image: url(header_asc.gif);
}
table.tablesorter thead tr .headerSortDown {
	background-image: url(header_desc.gif);
}

#alch_div table th { background:#555; color:#eee; }
#alch_div table td, #alch_div table th { padding: .5em !important; text-align:left; border:1px solid #ccc; }
.mobile #alch_div table td, #alch_div table th {border:2px solid #ccc;}
#alch_div table { border-collapse:collapse; background:#f0f0f0; width: 100%; }
#alch_div table tr.filtered .name_column, #alch_div table tr.filtered .name_column a {color:#aaa;}
body:not(.show_filtered) table#ingredients_table tr.filtered {display:none;} 
table#ingredients_table tr.unusable {display:none;}

input.abutton {font-size:1.1em; height:auto; padding:.5em 1em; background:#444; color:#eee; border-radius:.5em; cursor:pointer;}
input.abutton:disabled {background:#777;color:#ccc;}

#filtered_div table td {padding:0 !important;}
.filterBox {border:1px solid #ccc; padding:0 .3em; margin:.3em; display:inline-block; vertical-align:top; width: 270px;}
.mobile .filterBox {width: calc(50% - 4*.3em - .2em)}
.filterBox input[type=checkbox] {margin: 0 .2em 0 0;}

table.disabled td.filter {background-color: #ddd; color: #999;}
table.disabled td.filter input {opacity: 50%;}
.mobile table.disabled td.filter {display:none;}

.pointer, #alch_div a, #help_info a {cursor:pointer;}

#loading {margin: 2em 2em 2em 0; border:1px solid #eee; padding: .5em}
#progress_bar {background-color:#FFFFCC; border:1px solid #ccc; height: 1.5em; width: 100%}

#help_info {background-color: #CDD5DC; margin:1em 0; padding:.5em;}

.right-float-option { float:right; padding:.1em 1em; height: 0; position: relative; top: -2.6em; line-height: 1; }
.mobile .right-float-option { max-width: 30%; }

.mobile #potions_div th.ingredients_column label {margin-top: 1.5em;}

.potion { display: inline-block; padding: .5em .5em; line-height: 1.1; background-color: #ddd; border-radius: .1em; margin-right: 1em; margin-bottom: .5em; vertical-align:middle;}
.potion .green {color:#008000 !important;}
.potion .gold {color:#AA7A0A !important;}
.potion .red {color:#AA0000 !important;}
.no-red .potion.red {display:none !important;}
.base_ingredient_name, .potion a {display:inline-block;}
.potion a {vertical-align:middle;}
.mobile .potion a {width:calc(50% - 1.1em);}
.mobile .potion {display:block;}

.link-menu {position:absolute; z-index:99; background-color:#444; color:#eee; border-radius: .3em;}
.link-menu ul {margin:0; padding:0; list-style: none;}
.link-menu ul li {margin:.2em; padding:.5em; line-height: 1.1; cursor:pointer;}

.potions_quick_filter a {display: inline-block; background-color:#eee; margin:.2em; padding:.5em; line-height: 1.1; border-radius: .3em;}
</style>

<style type="text/css" id="potions-filter">
</style>

<script type="text/javascript" src="./files/jquery.min.js"></script>
<script type="text/javascript" src="./files/jquery.tablesorter.min.js"></script>

<script type="text/javascript">
window.mobileAndTabletCheck = function() {
  let check = false;
  (function(a){if(/(android|bb\d+|meego).+mobile|avantgo|bada\/|blackberry|blazer|compal|elaine|fennec|hiptop|iemobile|ip(hone|od)|iris|kindle|lge |maemo|midp|mmp|mobile.+firefox|netfront|opera m(ob|in)i|palm( os)?|phone|p(ixi|re)\/|plucker|pocket|psp|series(4|6)0|symbian|treo|up\.(browser|link)|vodafone|wap|windows ce|xda|xiino|android|ipad|playbook|silk/i.test(a)||/1207|6310|6590|3gso|4thp|50[1-6]i|770s|802s|a wa|abac|ac(er|oo|s\-)|ai(ko|rn)|al(av|ca|co)|amoi|an(ex|ny|yw)|aptu|ar(ch|go)|as(te|us)|attw|au(di|\-m|r |s )|avan|be(ck|ll|nq)|bi(lb|rd)|bl(ac|az)|br(e|v)w|bumb|bw\-(n|u)|c55\/|capi|ccwa|cdm\-|cell|chtm|cldc|cmd\-|co(mp|nd)|craw|da(it|ll|ng)|dbte|dc\-s|devi|dica|dmob|do(c|p)o|ds(12|\-d)|el(49|ai)|em(l2|ul)|er(ic|k0)|esl8|ez([4-7]0|os|wa|ze)|fetc|fly(\-|_)|g1 u|g560|gene|gf\-5|g\-mo|go(\.w|od)|gr(ad|un)|haie|hcit|hd\-(m|p|t)|hei\-|hi(pt|ta)|hp( i|ip)|hs\-c|ht(c(\-| |_|a|g|p|s|t)|tp)|hu(aw|tc)|i\-(20|go|ma)|i230|iac( |\-|\/)|ibro|idea|ig01|ikom|im1k|inno|ipaq|iris|ja(t|v)a|jbro|jemu|jigs|kddi|keji|kgt( |\/)|klon|kpt |kwc\-|kyo(c|k)|le(no|xi)|lg( g|\/(k|l|u)|50|54|\-[a-w])|libw|lynx|m1\-w|m3ga|m50\/|ma(te|ui|xo)|mc(01|21|ca)|m\-cr|me(rc|ri)|mi(o8|oa|ts)|mmef|mo(01|02|bi|de|do|t(\-| |o|v)|zz)|mt(50|p1|v )|mwbp|mywa|n10[0-2]|n20[2-3]|n30(0|2)|n50(0|2|5)|n7(0(0|1)|10)|ne((c|m)\-|on|tf|wf|wg|wt)|nok(6|i)|nzph|o2im|op(ti|wv)|oran|owg1|p800|pan(a|d|t)|pdxg|pg(13|\-([1-8]|c))|phil|pire|pl(ay|uc)|pn\-2|po(ck|rt|se)|prox|psio|pt\-g|qa\-a|qc(07|12|21|32|60|\-[2-7]|i\-)|qtek|r380|r600|raks|rim9|ro(ve|zo)|s55\/|sa(ge|ma|mm|ms|ny|va)|sc(01|h\-|oo|p\-)|sdk\/|se(c(\-|0|1)|47|mc|nd|ri)|sgh\-|shar|sie(\-|m)|sk\-0|sl(45|id)|sm(al|ar|b3|it|t5)|so(ft|ny)|sp(01|h\-|v\-|v )|sy(01|mb)|t2(18|50)|t6(00|10|18)|ta(gt|lk)|tcl\-|tdg\-|tel(i|m)|tim\-|t\-mo|to(pl|sh)|ts(70|m\-|m3|m5)|tx\-9|up(\.b|g1|si)|utst|v400|v750|veri|vi(rg|te)|vk(40|5[0-3]|\-v)|vm40|voda|vulc|vx(52|53|60|61|70|80|81|83|85|98)|w3c(\-| )|webc|whit|wi(g |nc|nw)|wmlb|wonu|x700|yas\-|your|zeto|zte\-/i.test(a.substr(0,4))) check = true;})(navigator.userAgent||navigator.vendor||window.opera);
  return check;
};
</script>

<script type="text/javascript">
var appVersion = '2.1';
var filteredDefault = [19,24,26,33,38,63,64];
var filteredIngredients = filteredDefault;
var filteredAddon = [];
var storedKeys = [];
var favoritePotions = {};
var potionsMap = {};

var idByIngredient = {};
var ingredientsByEffect = {};

// filtered check
function isFilteredIngredient(id) {
	return $.inArray(parseInt(id), filteredIngredients) > -1;
}
</script>

<script type="text/javascript">
var effectsWarning = [
"Повышение навыка: Зачарование",
"Повышение навыка: Кузнечное дело",
]

var effectsPositive = {
"Исцеление болезней":true,
"Урон здоровью":false,
"Урон магии":false,
"Повреждение регенерации магии":false,
"Урон запасу сил":false,
"Повреждение регенерации запаса сил":false,
"Страх":false,
"Повышение навыка: Изменение":true,
"Повышение искусства торговли":true,
"Повышение навыка: Блокирование":true,
"Повышение переносимого веса":true,
"Повышение навыка: Колдовство":true,
"Повышение навыка: Разрушение":true,
"Повышение навыка: Зачарование":true,
"Повышение здоровья":true,
"Повышение навыка: Тяжелая броня":true,
"Повышение навыка: Иллюзия":true,
"Повышение навыка: Легкая броня":true,
"Повышение навыка: Взлом":true,
"Повышение магии":true,
"Повышение искусства лучника":true,
"Повышение навыка: Одноручное оружие":true,
"Повышение навыка: Карманные кражи":true,
"Повышение навыка: Восстановление":true,
"Повышение навыка: Кузнечное дело":true,
"Повышение навыка: Скрытность":true,
"Повышение запаса сил":true,
"Повышение навыка: Двуручное оружие":true,
"Бешенство":false,
"Невидимость":true,
"Затяжной урон здоровью":false,
"Затяжной урон магии":false,
"Затяжной урон запасу сил":false,
"Паралич":false,
"Опустошение здоровья":false,
"Опустошение магии":false,
"Опустошение запаса сил":false,
"Регенерация здоровья":true,
"Регенерация магии":true,
"Регенерация запаса сил":true,
"Сопротивление огню":true,
"Сопротивление холоду":true,
"Сопротивление магии":true,
"Сопротивление ядам":true,
"Сопротивление электричеству":true,
"Восстановление здоровья":true,
"Восстановление магии":true,
"Восстановление запаса сил":true,
"Замедление":false,
"Водное дыхание":true,
"Уязвимость к огню":false,
"Уязвимость к холоду":false,
"Уязвимость к магии":false,
"Уязвимость к яду":false,
"Уязвимость к электричеству":false,
}

var effectsPrice = {
"Исцеление болезней":7,
"Урон здоровью":3,
"Урон магии":52,
"Повреждение регенерации магии":265,
"Урон запасу сил":43,
"Повреждение регенерации запаса сил":159,
"Страх":120,
"Повышение навыка: Изменение":47,
"Повышение искусства торговли":48,
"Повышение навыка: Блокирование":118,
"Повышение переносимого веса":208,
"Повышение навыка: Колдовство":75,
"Повышение навыка: Разрушение":151,
"Повышение навыка: Зачарование":14,
"Повышение здоровья":82,
"Повышение навыка: Тяжелая броня":55,
"Повышение навыка: Иллюзия":94,
"Повышение навыка: Легкая броня":55,
"Повышение навыка: Взлом":25,
"Повышение магии":71,
"Повышение искусства лучника":118,
"Повышение навыка: Одноручное оружие":118,
"Повышение навыка: Карманные кражи":118,
"Повышение навыка: Восстановление":118,
"Повышение навыка: Кузнечное дело":82,
"Повышение навыка: Скрытность":118,
"Повышение запаса сил":71,
"Повышение навыка: Двуручное оружие":118,
"Бешенство":107,
"Невидимость":261,
"Затяжной урон здоровью":86,
"Затяжной урон магии":71,
"Затяжной урон запасу сил":12,
"Паралич":285,
"Опустошение здоровья":6,
"Опустошение магии":15,
"Опустошение запаса сил":24,
"Регенерация здоровья":177,
"Регенерация магии":177,
"Регенерация запаса сил":177,
"Сопротивление огню":86,
"Сопротивление холоду":86,
"Сопротивление магии":51,
"Сопротивление ядам":118,
"Сопротивление электричеству":86,
"Восстановление здоровья":21,
"Восстановление магии":25,
"Восстановление запаса сил":25,
"Замедление":247,
"Водное дыхание":100,
"Уязвимость к огню":48,
"Уязвимость к холоду":40,
"Уязвимость к магии":51,
"Уязвимость к яду":51,
"Уязвимость к электричеству":56,
}
</script>

<script type="text/javascript">
var ingredientsList = {
1:{name:"Абесинский окунь", effects:["Уязвимость к холоду", "Повышение навыка: Скрытность", "Уязвимость к яду", "Повышение навыка: Восстановление"], weight:"0.5", price:"15"},
2:{name:"Алый корень Нирна", effects:["Урон здоровью", "Урон запасу сил", "Невидимость", "Сопротивление магии"], weight:"0.2", price:"10"},
3:{name:"Белянка", effects:["Уязвимость к холоду", "Повышение навыка: Тяжелая броня", "Восстановление магии", "Опустошение магии"], weight:"0.3", price:"0"},
4:{name:"Бесовский гриб", effects:["Урон здоровью", "Затяжной урон здоровью", "Паралич", "Восстановление здоровья"], weight:"0.3", price:"0"},
5:{name:"Бойцовая рыбка", effects:["Урон здоровью", "Повышение навыка: Изменение", "Замедление", "Повышение переносимого веса"], weight:"0.25", price:"15"},
6:{name:"Болотный стручок", effects:["Сопротивление электричеству", "Затяжной урон магии", "Паралич", "Восстановление здоровья"], weight:"0.25", price:"5"},
7:{name:"Большие рога", effects:["Восстановление запаса сил", "Повышение запаса сил", "Замедление", "Повреждение регенерации запаса сил"], weight:"0.1", price:"2"},
8:{name:"Бородатый мох", effects:["Урон магии", "Повышение здоровья", "Повреждение регенерации магии", "Повышение навыка: Одноручное оружие"], weight:"0.25", price:"1"},
9:{name:"Вересковое сердце", effects:["Восстановление магии", "Повышение навыка: Блокирование", "Паралич", "Повышение магии"], weight:"0.5", price:"20"},
10:{name:"Ветка чертополоха", effects:["Сопротивление холоду", "Опустошение запаса сил", "Сопротивление ядам", "Повышение навыка: Тяжелая броня"], weight:"0.1", price:"1"},
11:{name:"Виноград джазби", effects:["Уязвимость к магии", "Повышение магии", "Регенерация магии", "Опустошение здоровья"], weight:"0.2", price:"1"},
12:{name:"Гигантский лишайник", effects:["Уязвимость к электричеству", "Опустошение здоровья", "Уязвимость к яду", "Восстановление магии"], weight:"0.25", price:"5"},
13:{name:"Глаз саблезуба", effects:["Восстановление запаса сил", "Опустошение здоровья", "Урон магии", "Восстановление здоровья"], weight:"0.1", price:"2"},
14:{name:"Гниль Намиры", effects:["Урон магии", "Повышение навыка: Взлом", "Страх", "Регенерация здоровья"], weight:"0.25", price:"0"},
15:{name:"Голубой горноцвет", effects:["Восстановление здоровья", "Повышение навыка: Колдовство", "Повышение здоровья", "Повреждение регенерации магии"], weight:"0.1", price:"2"},
16:{name:"Двемерское масло", effects:["Уязвимость к магии", "Повышение навыка: Иллюзия", "Регенерация магии", "Восстановление магии"], weight:"0.25", price:"15"},
17:{name:"Жареная злокрысья кожа", effects:["Восстановление запаса сил", "Исцеление болезней", "Сопротивление ядам", "Восстановление здоровья"], weight:"0.5", price:"1"},
18:{name:"Жемчужина", effects:["Восстановление запаса сил", "Повышение навыка: Блокирование", "Восстановление магии", "Сопротивление электричеству"], weight:"0.1", price:"2"},
19:{name:"Живица сприггана", effects:["Повреждение регенерации магии", "Повышение навыка: Зачарование", "Повышение навыка: Кузнечное дело", "Повышение навыка: Изменение"], weight:"0.2", price:"15"},
20:{name:"Жир тролля", effects:["Сопротивление ядам", "Повышение навыка: Двуручное оружие", "Бешенство", "Урон здоровью"], weight:"1", price:"15"},
21:{name:"Зубы ледяного привидения", effects:["Уязвимость к холоду", "Повышение навыка: Тяжелая броня", "Невидимость", "Уязвимость к огню"], weight:"0.25", price:"30"},
22:{name:"Икра рыбы-убийцы", effects:["Сопротивление ядам", "Повышение навыка: Карманные кражи", "Затяжной урон здоровью", "Повышение запаса сил"], weight:"0.2", price:"3"},
23:{name:"Клешня грязевого краба", effects:["Восстановление запаса сил", "Исцеление болезней", "Сопротивление ядам", "Сопротивление огню"], weight:"0.25", price:"2"},
24:{name:"Клык саблезуба", effects:["Восстановление запаса сил", "Повышение навыка: Тяжелая броня", "Повышение навыка: Кузнечное дело", "Уязвимость к яду"], weight:"0.1", price:"2"},
25:{name:"Клюв ястреба", effects:["Восстановление запаса сил", "Сопротивление холоду", "Повышение переносимого веса", "Сопротивление электричеству"], weight:"0.25", price:"15"},
26:{name:"Коготь ворожеи", effects:["Сопротивление магии", "Затяжной урон магии", "Повышение навыка: Зачарование", "Повышение искусства торговли"], weight:"0.25", price:"20"},
27:{name:"Корень Нирна", effects:["Урон здоровью", "Урон запасу сил", "Невидимость", "Сопротивление магии"], weight:"0.2", price:"10"},
28:{name:"Костная мука", effects:["Урон запасу сил", "Сопротивление огню", "Повышение навыка: Колдовство", "Опустошение запаса сил"], weight:"0.5", price:"5"},
29:{name:"Красный горноцвет", effects:["Восстановление магии", "Опустошение магии", "Повышение магии", "Урон здоровью"], weight:"0.1", price:"2"},
30:{name:"Кровавый венец", effects:["Уязвимость к огню", "Повышение навыка: Блокирование", "Уязвимость к яду", "Сопротивление магии"], weight:"0.3", price:"10"},
31:{name:"Крыло лунного мотылька", effects:["Урон магии", "Повышение навыка: Легкая броня", "Регенерация здоровья", "Невидимость"], weight:"0.1", price:"5"},
32:{name:"Крыло монарха", effects:["Восстановление здоровья", "Повышение искусства торговли", "Затяжной урон запасу сил", "Урон магии"], weight:"0.1", price:"3"},
33:{name:"Крыло синей бабочки", effects:["Урон запасу сил", "Повышение навыка: Колдовство", "Повреждение регенерации магии", "Повышение навыка: Зачарование"], weight:"0.1", price:"2"},
34:{name:"Куриное яйцо", effects:["Сопротивление магии", "Повреждение регенерации магии", "Водное дыхание", "Затяжной урон запасу сил"], weight:"0.5", price:"2"},
35:{name:"Лаванда", effects:["Сопротивление магии", "Повышение запаса сил", "Опустошение магии", "Повышение навыка: Колдовство"], weight:"0.1", price:"1"},
36:{name:"Лиловый горноцвет", effects:["Восстановление запаса сил", "Повышение навыка: Скрытность", "Затяжной урон магии", "Сопротивление холоду"], weight:"0.1", price:"2"},
37:{name:"Лунный сахар", effects:["Уязвимость к огню", "Сопротивление холоду", "Восстановление магии", "Регенерация магии"], weight:"0.25", price:"50"},
38:{name:"Лютый гриб", effects:["Урон запасу сил", "Бешенство", "Восстановление здоровья", "Повышение навыка: Кузнечное дело"], weight:"0.2", price:"12"},
39:{name:"Маленькая жемчужина", effects:["Восстановление запаса сил", "Повышение навыка: Одноручное оружие", "Повышение навыка: Восстановление", "Сопротивление холоду"], weight:"0.1", price:"2"},
40:{name:"Маленькие рога", effects:["Уязвимость к яду", "Повышение навыка: Восстановление", "Затяжной урон запасу сил", "Урон здоровью"], weight:"0.1", price:"2"},
41:{name:"Медвежьи когти", effects:["Восстановление запаса сил", "Повышение здоровья", "Повышение навыка: Одноручное оружие", "Повреждение регенерации магии"], weight:"0.1", price:"2"},
42:{name:"Медовые соты", effects:["Восстановление запаса сил", "Повышение навыка: Блокирование", "Повышение навыка: Легкая броня", "Опустошение запаса сил"], weight:"1", price:"5"},
43:{name:"Мора тапинелла", effects:["Восстановление магии", "Затяжной урон здоровью", "Регенерация запаса сил", "Повышение навыка: Иллюзия"], weight:"0.25", price:"4"},
44:{name:"Морозная мириам", effects:["Сопротивление холоду", "Повышение навыка: Скрытность", "Опустошение магии", "Повреждение регенерации запаса сил"], weight:"0.1", price:"1"},
45:{name:"Морозная соль", effects:["Уязвимость к огню", "Сопротивление холоду", "Восстановление магии", "Повышение навыка: Колдовство"], weight:"0.25", price:"100"},
46:{name:"Морской желудь", effects:["Урон магии", "Водное дыхание", "Регенерация здоровья", "Повышение навыка: Карманные кражи"], weight:"0.2", price:"5"},
47:{name:"Мухомор", effects:["Сопротивление огню", "Повышение навыка: Двуручное оружие", "Бешенство", "Регенерация запаса сил"], weight:"0.1", price:"2"},
48:{name:"Огненная соль", effects:["Уязвимость к холоду", "Сопротивление огню", "Восстановление магии", "Регенерация магии"], weight:"0.25", price:"50"},
49:{name:"Оранжевая стрекоза", effects:["Восстановление запаса сил", "Опустошение магии", "Повышение навыка: Карманные кражи", "Затяжной урон здоровью"], weight:"0.1", price:"1"},
50:{name:"Палец великана", effects:["Урон запасу сил", "Повышение здоровья", "Повышение переносимого веса", "Повреждение регенерации запаса сил"], weight:"1", price:"20"},
51:{name:"Паслен", effects:["Урон здоровью", "Повреждение регенерации магии", "Затяжной урон запасу сил", "Повышение навыка: Разрушение"], weight:"0.1", price:"8"},
52:{name:"Паучье яйцо", effects:["Урон запасу сил", "Повреждение регенерации магии", "Повышение навыка: Взлом", "Повышение искусства лучника"], weight:"0.2", price:"5"},
53:{name:"Пелена дымка", effects:["Восстановление запаса сил", "Повышение навыка: Разрушение", "Повышение переносимого веса", "Сопротивление магии"], weight:"0.1", price:"2"},
54:{name:"Перья ворожеи", effects:["Урон магии", "Повышение навыка: Колдовство", "Бешенство", "Уязвимость к электричеству"], weight:"0.1", price:"20"},
55:{name:"Перья ястреба", effects:["Исцеление болезней", "Повышение навыка: Легкая броня", "Повышение навыка: Одноручное оружие", "Повышение навыка: Скрытность"], weight:"0.1", price:"15"},
56:{name:"Ползучая лоза", effects:["Восстановление магии", "Повреждение регенерации запаса сил", "Повышение переносимого веса", "Уязвимость к магии"], weight:"0.2", price:"1"},
57:{name:"Прах вампира", effects:["Невидимость", "Восстановление магии", "Регенерация здоровья", "Исцеление болезней"], weight:"0.2", price:"25"},
58:{name:"Пушица", effects:["Сопротивление магии", "Повышение магии", "Повышение навыка: Блокирование", "Повышение искусства торговли"], weight:"0.1", price:"1"},
59:{name:"Пчела", effects:["Восстановление запаса сил", "Опустошение запаса сил", "Регенерация запаса сил", "Уязвимость к электричеству"], weight:"0.1", price:"3"},
60:{name:"Пчелиное гнездо", effects:["Сопротивление ядам", "Повышение навыка: Легкая броня", "Повышение навыка: Скрытность", "Повышение навыка: Разрушение"], weight:"1", price:"5"},
61:{name:"Пшеница", effects:["Восстановление здоровья", "Повышение здоровья", "Повреждение регенерации запаса сил", "Затяжной урон магии"], weight:"0.1", price:"5"},
62:{name:"Светящаяся пыль", effects:["Урон магии", "Повреждение регенерации магии", "Повышение навыка: Разрушение", "Сопротивление электричеству"], weight:"0.5", price:"20"},
63:{name:"Светящийся гриб", effects:["Сопротивление электричеству", "Повышение навыка: Разрушение", "Повышение навыка: Кузнечное дело", "Повышение здоровья"], weight:"0.2", price:"5"},
64:{name:"Сердце даэдра", effects:["Восстановление здоровья", "Повреждение регенерации запаса сил", "Урон магии", "Страх"], weight:"0.5", price:"250"},
65:{name:"Серебристый окунь", effects:["Восстановление запаса сил", "Повреждение регенерации запаса сил", "Опустошение здоровья", "Сопротивление холоду"], weight:"0.25", price:"15"},
66:{name:"Синяя стрекоза", effects:["Сопротивление электричеству", "Повышение навыка: Карманные кражи", "Восстановление здоровья", "Страх"], weight:"0.1", price:"1"},
67:{name:"Сиродильский лопатохвост", effects:["Урон запасу сил", "Повышение навыка: Восстановление", "Страх", "Опустошение здоровья"], weight:"0.25", price:"15"},
68:{name:"Снежные ягоды", effects:["Сопротивление огню", "Повышение навыка: Зачарование", "Сопротивление холоду", "Сопротивление электричеству"], weight:"0.1", price:"4"},
69:{name:"Собачий корень", effects:["Урон запасу сил", "Повышение навыка: Одноручное оружие", "Повышение искусства лучника", "Паралич"], weight:"0.1", price:"5"},
70:{name:"Соль", effects:["Уязвимость к магии", "Повышение навыка: Восстановление", "Замедление", "Регенерация магии"], weight:"0.2", price:"2"},
71:{name:"Соль пустоты", effects:["Уязвимость к электричеству", "Сопротивление магии", "Урон здоровью", "Повышение магии"], weight:"0.2", price:"125"},
72:{name:"Стержневой корень", effects:["Уязвимость к магии", "Повышение навыка: Иллюзия", "Регенерация магии", "Восстановление магии"], weight:"0.5", price:"15"},
73:{name:"Толченый бивень мамонта", effects:["Восстановление запаса сил", "Повышение навыка: Скрытность", "Уязвимость к огню", "Страх"], weight:"0.1", price:"2"},
74:{name:"Торакс светлячка", effects:["Восстановление запаса сил", "Затяжной урон магии", "Уязвимость к магии", "Повышение запаса сил"], weight:"0.1", price:"1"},
75:{name:"Травяной стручок", effects:["Сопротивление ядам", "Опустошение магии", "Повышение навыка: Изменение", "Восстановление магии"], weight:"0.1", price:"1"},
76:{name:"Ухо фалмера", effects:["Урон здоровью", "Бешенство", "Сопротивление ядам", "Повышение навыка: Взлом"], weight:"0.2", price:"10"},
77:{name:"Хвост злокрыса", effects:["Повреждение регенерации запаса сил", "Опустошение здоровья", "Урон здоровью", "Повышение навыка: Легкая броня"], weight:"0.2", price:"3"},
78:{name:"Хисткарп", effects:["Восстановление запаса сил", "Повышение магии", "Повреждение регенерации запаса сил", "Водное дыхание"], weight:"0.25", price:"6"},
79:{name:"Человеческое сердце", effects:["Урон здоровью", "Урон магии", "Повреждение регенерации магии", "Бешенство"], weight:"1", price:"0"},
80:{name:"Человечье мясо", effects:["Урон здоровью", "Паралич", "Восстановление магии", "Повышение навыка: Скрытность"], weight:"0.25", price:"1"},
81:{name:"Чеснок", effects:["Сопротивление ядам", "Повышение запаса сил", "Регенерация магии", "Регенерация здоровья"], weight:"0.25", price:"1"},
82:{name:"Чешуйчатка", effects:["Уязвимость к магии", "Повышение навыка: Иллюзия", "Регенерация запаса сил", "Повышение переносимого веса"], weight:"0.25", price:"4"},
83:{name:"Чешуя рыбы-убийцы", effects:["Сопротивление холоду", "Затяжной урон здоровью", "Повышение навыка: Тяжелая броня", "Повышение навыка: Блокирование"], weight:"0.1", price:"3"},
84:{name:"Эктоплазма", effects:["Восстановление магии", "Повышение навыка: Разрушение", "Повышение магии", "Урон здоровью"], weight:"0.1", price:"25"},
85:{name:"Эльфийское ухо", effects:["Восстановление магии", "Повышение искусства лучника", "Уязвимость к холоду", "Сопротивление огню"], weight:"0.1", price:"10"},
86:{name:"Ягоды можжевельника", effects:["Уязвимость к огню", "Повышение искусства лучника", "Регенерация здоровья", "Повреждение регенерации запаса сил"], weight:"0.1", price:"1"},
87:{name:"Ядовитый колокольчик", effects:["Урон здоровью", "Опустошение запаса сил", "Замедление", "Уязвимость к яду"], weight:"0.1", price:"4"},
88:{name:"Язык дракона", effects:["Сопротивление огню", "Повышение искусства торговли", "Повышение навыка: Иллюзия", "Повышение навыка: Двуручное оружие"], weight:"0.1", price:"5"},
89:{name:"Яйцо коруса", effects:["Уязвимость к яду", "Повышение запаса сил", "Урон магии", "Невидимость"], weight:"0.2", price:"10"},
90:{name:"Яйцо оригмы", effects:["Восстановление здоровья", "Повышение навыка: Одноручное оружие", "Урон запасу сил", "Уязвимость к магии"], weight:"0.5", price:"2"},
91:{name:"Яйцо соснового дрозда", effects:["Восстановление запаса сил", "Повышение навыка: Взлом", "Уязвимость к яду", "Сопротивление электричеству"], weight:"0.5", price:"2"},
// The Elder Scrolls V: Dawnguard
92:{name:"Жёлтый горноцвет", type:"DG", effects:["Сопротивление ядам", "Повышение здоровья", "Повышение навыка: Восстановление", "Повреждение регенерации запаса сил"], weight:"0.1", price:"2"},
93:{name:"Крыло мотылька предка", type:"DG", effects:["Урон запасу сил", "Повышение навыка: Колдовство", "Повреждение регенерации магии", "Повышение навыка: Зачарование"], weight:"0.1", price:"2"},
94:{name:"Светящийся цветок", type:"DG", effects:["Сопротивление магии", "Страх", "Регенерация здоровья", "Паралич"], weight:"0.1", price:"5"},
95:{name:"Усик коруса-охотника", type:"DG", effects:["Урон запасу сил", "Повышение навыка: Колдовство", "Повреждение регенерации магии", "Повышение навыка: Зачарование"], weight:"0.1", price:"2"},
96:{name:"Ядовитый цветок", type:"DG", effects:["Урон здоровью", "Страх", "Повышение переносимого веса", "Замедление"], weight:"0.1", price:"5"},
// The Elder Scrolls V: Hearthfire
97:{name:"Лососёвая икра", type:"HF", effects:["Водное дыхание", "Повышение магии", "Регенерация магии", "Восстановление запаса сил"], weight:"0.2", price:"5"},
98:{name:"Яйцо ястреба", type:"HF", effects:["Сопротивление магии", "Водное дыхание", "Повреждение регенерации магии", "Затяжной урон запасу сил"], weight:"0.5", price:"5"},
// The Elder Scrolls V: Dragonborn
99:{name:"Вредозобник", type:"D", effects:["Опустошение здоровья", "Опустошение запаса сил", "Опустошение магии", "Затяжной урон здоровью"], weight:"0.1", price:"1"},
100:{name:"Древесина горелого сприггана", type:"D", effects:["Уязвимость к огню", "Повышение навыка: Изменение", "Повреждение регенерации магии", "Замедление"], weight:"0.5", price:"20"},
101:{name:"Желе нетча", type:"D", effects:["Паралич", "Повышение переносимого веса", "Восстановление запаса сил", "Страх"], weight:"0.5", price:"20"},
102:{name:"Желе пепельного прыгуна", type:"D", effects:["Восстановление здоровья", "Повышение навыка: Легкая броня", "Сопротивление электричеству", "Уязвимость к холоду"], weight:"0.25", price:"20"},
103:{name:"Императорский зонтичный мох", type:"D", effects:["Урон здоровью", "Повышение магии", "Регенерация здоровья", "Повышение навыка: Двуручное оружие"], weight:"0.25", price:"1"},
104:{name:"Кабаний клык", type:"D", effects:["Повышение запаса сил", "Повышение здоровья", "Повышение навыка: Блокирование", "Бешенство"], weight:"0.5", price:"20"},
105:{name:"Корень трамы", type:"D", effects:["Уязвимость к электричеству", "Повышение переносимого веса", "Урон магии", "Замедление"], weight:"0.2", price:"1"},
106:{name:"Пепел порождения", type:"D", effects:["Опустошение запаса сил", "Сопротивление огню", "Повышение навыка: Зачарование", "Опустошение магии"], weight:"0.1", price:"20"},
107:{name:"Пепельная ползучая лоза", type:"D", effects:["Урон запасу сил", "Невидимость", "Сопротивление огню", "Повышение навыка: Разрушение"], weight:"0.25", price:"20"},
108:{name:"Перья фельсадской крачки", type:"D", effects:["Восстановление здоровья", "Повышение навыка: Легкая броня", "Исцеление болезней", "Сопротивление магии"], weight:"0.1", price:"15"},
109:{name:"Стручок пепельной травы", type:"D", effects:["Сопротивление огню", "Уязвимость к электричеству", "Повышение навыка: Взлом", "Повышение навыка: Скрытность"], weight:"0.1", price:"1"},
//regex ^([^\t]+)\t([^\t]+)\t([^\t]+)\t([^\t]+)\t([^\t]+)\t([^\t]+)\t([^\t]+)
//:{name:"\2", effects:["\4", "\5", "\6", "\7"], weight:"0.1", price:"2"},
};
</script>

<script type="text/javascript">
//calc max price
var maxEPrice = 0;
for (var i in effectsPrice)
	if (maxEPrice < effectsPrice[i])
		maxEPrice = effectsPrice[i];

// calc sum price of effects
function calcEPrice(effects) {
	var deltaPN = 80/100;
	var priceP = 0;
	var priceN = 0;
	for (var i in effects)
		if (effectsPositive[effects[i]])
			priceP += effectsPrice[effects[i]];
		else
			priceN += effectsPrice[effects[i]];
	return Math.round( priceP < priceN ? priceN + priceP*deltaPN : priceP + priceN*deltaPN );
}

function prepareingredientsList() {
	var str='';
	$("table#ingredients_table tbody tr").each(function(_i, tr) {
		var id = getRowId(tr);
		var i = ingredientsList[id];
		str += id+':{name:"'+i.name+'", effects:["'+i.effects[0]+'", "'+i.effects[1]+'", "'+i.effects[2]+'", "'+i.effects[3]+'"], weight:"'+i.weight+'", price:"'+i.price+'"},<br>';
	});
	$('#loading').html(str);
	$("#loading").show();
	$("#alch_div").hide();
}

//prepare referencing array
function prepareIngredientsIndex(list) {
	// prepare hashmap of effects
	ingredientsByEffect = {};
	for (var i in effectsPrice) {
		ingredientsByEffect[i] = [];
	}
	for (var id of Object.keys(list)) {
		var ingredient = ingredientsList[id];
		for (var l=0; l<4; l++) {
			var effect = ingredient.effects[l];
			if (ingredientsByEffect[effect] == undefined)
				alert(effect+' - undefined!');
			else
				ingredientsByEffect[effect].push(parseInt(id));
		}
	}
}

// concat two arrays
// x = in both arrays values
// or = only in one array values
function getXorArray(arr1, arr2) {
	var xArr = [];
	var orArr = arr1.concat(arr2).sort();
	for (var i=0; i < orArr.length; ) {
		if(orArr[i] == orArr[i+1]) {
			xArr.push(orArr[i]);
			var k = 2;
			for (var j=i+2; j < orArr.length && orArr[i] == orArr[j]; j++) k++;
			orArr.splice(i, k);
		} else {
			i++;
		}
	}
	return {x:xArr, or:orArr};
}

// prepare potion
function makeMixing(effects1, effects2) {
	var mix = getXorArray(effects1, effects2);
	var price = calcEPrice(mix.x);
	return {price:price, effects:mix.x, unused:mix.or};
}

// potion key
function makeMixKey(id2, id3) {
	return id2 < id3 ? ''+id2+'+'+id3 : ''+id3+'+'+id2;
}

// investigate all potions with selected ingredient
function makeIngredientBestPrice(id, includeFiltered) {
	var priceById = {};
	var mixList = {};
	var hashList = {};
	var maxPrice = 0;
	// get the list of second ingredients with same effects
	var effects1 = ingredientsList[id].effects;
	var ingredients2 = [];
	for (var i=0; i<effects1.length; i++) {
		ingredients2 = ingredients2.concat( ingredientsByEffect[ effects1[i] ] );
	}
	// loop in second ingredients
	ingredients2.sort();
	for (var i2=0; i2<ingredients2.length; i2++) {
		var id2 = ingredients2[i2];
		// filter first, doubled and filtered
		if (id2 != id && id2 != ingredients2[i2+1] && (includeFiltered || !isFilteredIngredient(id2))) {
			var potion2 = makeMixing(effects1, ingredientsList[id2].effects);
			// get the list of third ingredients with unused effects
			var effects2 = potion2.unused;
			var ingredients3 = [];
			for (var i=0; i<effects2.length; i++) {
				ingredients3 = ingredients3.concat( ingredientsByEffect[ effects2[i] ] );
			}
			// loop in third ingredients
			var bestPrice2 = 0;
			ingredients3.sort();
			for (var i3=0; i3<ingredients3.length; i3++) {
				var id3 = ingredients3[i3];
				// filter first, second, doubled and filtered
				if (id3 != id && id3 != id2 && id3 != ingredients3[i3+1] && (includeFiltered || !isFilteredIngredient(id3))) {
					var potion3 = makeMixing(effects2, ingredientsList[id3].effects);
					// final price
					var finPrice = calcEPrice( potion2.effects.concat(potion3.effects) );
					// final check
					if (bestPrice2 < finPrice) {
						bestPrice2 = finPrice;
					}
					// to list
					var key = makeMixKey(id2, id3);
					if (mixList[finPrice] == undefined) {
						mixList[finPrice] = [];
						hashList[finPrice] = {};
					}
					if (hashList[finPrice][key] == undefined) {
						hashList[finPrice][key] = true;
						mixList[finPrice].push( [id2, id3] );
					}
					// max price
					if (maxPrice < finPrice) maxPrice = finPrice;
				}
			}
			priceById[id2] = bestPrice2;
		}
	}
	// sorting
 	//var listKeys = Object.keys(mixList).sort(function(a,b){return b-a;});
	return {price:maxPrice, list:mixList, priceById:priceById};
}

// prepare a title
function makeMixTitle(mixes) {
	var title = '';
	for (var i in mixes) {
		title += (title!=''?' &nbsp;|&nbsp; ':'') + ingredientsList[mixes[i][0]].name+' + '+ingredientsList[mixes[i][1]].name;
	}
	return title;
}
</script>

<script type="text/javascript">
// ==================================================================================================================
// Make mix UI functions

	var currentIngredient = null;
	var currentIngredient2 = null;
	var potionsIsFull = false;
	var potionsId = 0;
	var potionsHistory = [];


	function getRowId(e) {
		return parseInt($(e).attr('origindex'));
	}

	function getRowById(id) {
		return $("table#ingredients_table tbody tr[origindex="+id+"]");
	}

	function getEffectsFromRow(e) {
		return ingredientsList[getRowId(e)].effects.slice(0); //clone
	}

	function clearActiveIngredients() {
		if (currentIngredient != null) {
			getRowById(currentIngredient).removeClass('unusable');
			currentIngredient = null;
		}
		if (currentIngredient2 != null) {
			getRowById(currentIngredient2).removeClass('unusable');
			currentIngredient2 = null;
		}
		$('#ingredient_filter table tbody').children().remove();
	}

	function clickIngredientFilter(e) {
		clearActiveIngredients();
		clickIngredient(e);
	}

	function clickIngredient(e) {
		var id = e.data;
		var $tr = getRowById(id);
		var ingredient = ingredientsList[id];
		var effects = ingredient.effects;
		var dubEffects = [];

		if (currentIngredient != null) {
			effects = effects.concat(ingredientsList[currentIngredient].effects).sort();
			for (var i=0; i<effects.length;) {
				if(effects[i] == effects[i+1]) {
					dubEffects.push(effects[i]);
					effects.splice(i, 2);
				} else {
					i++;
				}
			}
			currentIngredient2 = id;
		} else {
			currentIngredient = id;
		}

		// change mobile mode
		$('body').addClass('p-mode');

		// clear effects highlighting
		$("#ingredient_filter tbody tr a, table#ingredients_table tbody tr a").removeClass('highlighted');

		// coppy row
		var $watchRow = $tr.clone(true);
		// change name click action
		$watchRow.find('td.name_column a').off('click').click(id, clickIngredientFilter);
		// info
		$watchRow.find('td.weight-place').html(ingredient.weight);
		$watchRow.find('td.price-place').html(ingredient.price);

		// update filter
		var $childrens = $('#ingredient_filter table tbody').children();
		if ($childrens.size() > 1)
			$childrens.last().remove();
		$('#ingredient_filter table tbody').append($watchRow);

		// filter effects highlighting
		if (dubEffects.length > 0) {
			$("#ingredient_filter tbody td>a").each(function(i, checkA) {
				var effect = $(checkA).html();
				if ($.inArray(effect, dubEffects) > -1) {
					$(checkA).addClass('highlighted');
				}
			});
		}

		// update main table
		$("table#ingredients_table tbody tr").each(function(i, checkRow) {
			var id = getRowId(checkRow);
			if (id == currentIngredient)
				return;
			var ingredient = ingredientsList[id];
			var rowEffects = ingredient.effects;
			var show = 0;
			var _dubEffects = dubEffects.slice(); // make coppy
			for (var i in rowEffects) {
				for (var j in effects) {
					if (rowEffects[i] == effects[j]) {
						show++;
						_dubEffects.push(rowEffects[i]);
						$(checkRow).find("a:contains('" + rowEffects[i] + "')").addClass('highlighted');
					}
				}
			}
			if (show>0) {
				$(checkRow).removeClass('unusable');
				if (show>1) {
					$(checkRow).find(".name_column a").addClass('highlighted');
				}
				// info
				$(checkRow).find("td.weight-place").html(ingredient.weight);
				// price
				$(checkRow).find("td.price-place").html(calcEPrice(_dubEffects));
			} else {
				$(checkRow).addClass('unusable');
			}
		});
		$("#ingredients_table").trigger("update");
		window.setTimeout( function() {
			// sort by price
			$("#ingredients_table").trigger("sorton", [[[3,1]]]);
		}, 100);

		$('#all_ingredients').hide();
		$('#effects_filter').hide();
		$('#ingredient_filter').show();

		if (currentIngredient != null)
			getRowById(currentIngredient).addClass('unusable');
		$tr.addClass('unusable');

		window.scrollTo(0,$('#filter_div').position().top+15);
		return false;
	}

	function clickEffect(e) {
		$("table#ingredients_table tbody tr a").removeClass('highlighted');
		td = $(this).parent();
		effect = td.find('a').prop('title').trim();

		$("table#ingredients_table tbody tr").each(function(i, checkRow) {
			var rowEffects = getEffectsFromRow(checkRow);
			var show = false;
			if ($.inArray(effect, rowEffects) > -1) {
				show = true;
				$(checkRow).find('a[title="' + effect + '"]').each(function(i, e) {
					$(e).addClass('highlighted');
				});
			}
			if (!show) {
				$(checkRow).addClass('unusable');
			} else {
				$(checkRow).removeClass('unusable');
			}
		});

		$("#effect_name").text(effect);

		$('#all_ingredients').hide();
		$('#ingredient_filter').hide();
		$('#effects_filter').show();
		currentIngredient = null;
		$('#ingredient_filter table tbody').children().remove();

		window.scrollTo(0,$('#filter_div').position().top+15);
	}

	function showAll() {
		$('body').removeClass('p-mode');
		$('#all_ingredients').show();
		$('#ingredient_filter').hide();
		$('#effects_filter').hide();
		$("table#ingredients_table tbody tr a").removeClass('highlighted');
		$("table#ingredients_table tbody tr").removeClass('unusable');
		currentIngredient = null;
		$('#ingredient_filter table tbody').children().remove();
		// restore ingredient price column
		$("#ingredients_table tbody tr").each(function(i, checkRow) {
			var id = getRowId(checkRow);
			var ingredient = ingredientsList[id];
			$(checkRow).find("td.price-place").html(ingredient.price);
		});
		// sort by name
		$("#ingredients_table").trigger("sorton", [[[0,0]]]);
	}


	// ==================================================================================================================
	// Filter UI functions

	function showFiltered() {
		// fill filter checkboxes
		var filter = { 'N':'', 'DG':'', 'HF':'', 'D':'' };
		for (var name in idByIngredient) {
			var id = idByIngredient[name];
			var div = '<div class="filterBox"><label><input type="checkbox" name="fi_'+id+'" title="'+name+'" value="'+id+'"'+(!isFilteredIngredient(id)?' checked':'')+' onclick="editFilterCheckboxClick(this)"/>'+name+'</label></div>';
			filter[ingredientsList[id].type || 'N'] += div;
		}
		$('#filtered_div table[type="N"] td.filter').html(filter['N']);
		$('#filtered_div table[type="DG"] td.filter').html(filter['DG']);
		$('#filtered_div table[type="HF"] td.filter').html(filter['HF']);
		$('#filtered_div table[type="D"] td.filter').html(filter['D']);
		// set addon checkboxes
		$('#filtered_div table').removeClass('disabled');
		$('#filtered_div input[name=afilter]').prop('checked', true);
		filteredAddon.forEach(function(v, i) {
			$('#filtered_div input[name=afilter][value="'+v+'"]').removeAttr('checked');
			$('#filtered_div table[type="'+v+'"]').addClass('disabled');
		});
		// show
		$('#filtered_show_div').hide();
		$('#filtered_div').show();

		// add checkboxes into others tables
		$('table.ingredients').addClass('filter-edit-mode');
		$('table.ingredients tbody tr').each(function(i, tr) {
			var $td1 = $(tr).find('td:first');
			var id = getRowId(tr);
			$td1.prepend('<input type="checkbox" name="fi_'+id+'" title="'+id+'" value="'+id+'"'+(!isFilteredIngredient(id)?' checked':'')+' onclick="editFilterCheckboxClick(this)"/>');
		});
	}

	function selectFiltered() {
		// fill list
		var $place = $('#filtered_list_div tbody td:first');
		$place.html('');
		storedKeys.forEach(function(key) {
			$place.append( $('<div class="filterBox pointer">'+key+'</div>').click(key, clickFilterKey) );
		});
		// show
		$('#filtered_div').hide();
		$('#filtered_list_div').show();
	}

	function clickFilterKey(e) {
		var key = e.data;
		$('#filtered_list_div').hide();
		// load
		if (loadFiltered(key)) {
			console.log(key,filteredIngredients)
			applyLoadedFiltered();
		} else {
			// show
			$('#filtered_div').show();
		}
	}

	// Apply loaded
	function applyLoadedFiltered() {
		// culc best price
		for (var i in potionsMap) {
			potionsMap[i].best = makeIngredientBestPrice(i, false);
		}

		// save
		saveState();

		// update table
		prepareIngredientsTable();
		window.setTimeout( function() {
			$("#ingredients_table").trigger("sorton", [$("#ingredients_table").get(0).config.sortList]);
		}, 100);

		// close
		refreshPotions();
		closeFiltered();
	}

	// update checked status by loaded
	function reloadFiltered() {
		$('#filtered_div table input[name*="fi_"], table.ingredients input[name*="fi_"]').prop('checked', true);
		filteredIngredients.forEach(function(id) {
			$('#filtered_div table input[name=fi_'+id+'], table.ingredients input[name=fi_'+id+']').removeAttr('checked');
		});
	}

	// filter checkbox click handler
	function editFilterCheckboxClick(e) {
		var id = e.value;
		var checked = e.checked;
		$('#filtered_div table input[name=fi_'+id+'], table.ingredients input[name=fi_'+id+']').prop('checked', checked);
	}

	// toggle all click handler
	function toggleAllFiltered(e) {
		if (e.checked) {
			$(e).closest('table').find('td.filter input[type=checkbox]').prop('checked', true);
		} else {
			$(e).closest('table').find('td.filter input[type=checkbox]').removeAttr('checked');
		}
	}

	// addon checkbox click handler
	function toggleFilteredA(e) {
		var type = e.value;
		if (e.checked) {
			$('#filtered_div table[type="'+type+'"]').removeClass('disabled');
		} else {
			$('#filtered_div table[type="'+type+'"]').addClass('disabled');
		}
	}

	// Apply filtering
	function applyFiltered() {
		// prompt a key
		var key = prompt('Имя фильтра:', loadLastKey());
		if (key === null) return false;

		// update filtered array
		filteredIngredients = [];
		$("#filtered_div table td.filter input:not(:checked)").each(function(i, e) {
			filteredIngredients.push(parseInt($(e).val()));
		});

		// update filtered addon
		var dirty = false;
		$('#filtered_div input[name=afilter]').each(function(i, e) {
			if (e.checked) {
				var i = filteredAddon.indexOf(e.value);
				if (i != -1) {
					dirty = true;
					filteredAddon.splice(i, 1);
				}
			} else {
				if (!filteredAddon.includes(e.value)) {
					dirty = true;
					filteredAddon.push(e.value);
				}
			}
		});

		if (dirty) {
			// update potions list & index
			potionsMap = {};
			for (var i in ingredientsList) {
				var type = ingredientsList[i].type;
				if (!type || !filteredAddon.includes(type)) {
					potionsMap[i] = {};
				}
			}
			prepareIngredientsIndex(potionsMap);

			// culc full best price
			for (var i in potionsMap) {
				potionsMap[i].bestFull = makeIngredientBestPrice(i, true);
			}
		}

		// culc best price
		for (var i in potionsMap) {
			potionsMap[i].best = makeIngredientBestPrice(i, false);
		}

		// save
		saveFiltered(key);
		saveState();

		// update table
		prepareIngredientsTable();
		window.setTimeout( function() {
			$("#ingredients_table").trigger("sorton", [$("#ingredients_table").get(0).config.sortList]);
		}, 100);

		// close
		refreshPotions();
		closeFiltered();
	}

	function closeFiltered() {
		$('table.ingredients input[type=checkbox]').remove();
		$('table.ingredients').removeClass('filter-edit-mode');
		$('#filtered_div').hide();
		$('#filtered_list_div').hide();
		$('#filtered_show_div').show();
	}


	// ==================================================================================================================
	// Storage functions

	function loadLastKey() {
		var data = storageGetData();
		if (!data || !data.lastKey)
			return '1';
		return data.lastKey;
	}

	function saveFiltered(key) {
		var data = storageGetData();
		if (!data || !data.saves) data = {saves:{}};
		data.lastKey = key || '1';
		data.saves[data.lastKey] = filteredIngredients;
		if (storageSaveData(data)) {
			storedKeys = Object.keys(data.saves);
			return true;
		}
		return false;
	}

	function loadFiltered(key) {
		var data = storageVerifyData();
		if (!data || !data.saves)
			return false;
		filteredIngredients = data.saves[key || data.lastKey];
		storedKeys = Object.keys(data.saves);
		if (key) {
			data.lastKey = key;
			return storageSaveData(data);
		}
		return true;
	}

	function saveState() {
		var data = storageGetData();
		if (!data) data = {};
		data.potionsMap = potionsMap;
		data.filteredAddon = filteredAddon;
		return storageSaveData(data);
	}

	function loadState() {
		var data = storageVerifyData();
		if (!data || !data.filteredAddon)
			return false;
		filteredAddon = data.filteredAddon;
		if (!data.potionsMap)
			return false;
		potionsMap = data.potionsMap;
		return true;
	}

	// get data from storage and verify version
	function storageVerifyData() {
		var data = storageGetData();
		if (!data || data.version !== appVersion)
			return false;
		return data;
	}

	// get data from storage
	function storageGetData() {
		if (!supportsLocalStorage()) return false;
		var data;
		try{ data = localStorage.getItem('skyrim_alchemy_tool'); }catch(e){ }
		try{ data = JSON.parse(data); }catch(e){ }
		if (!data) data = {};
		return data;
	}

	// save data to storage
	function storageSaveData(data) {
		data.version = appVersion;
		delete data.ingredientsList;
		console.log('STORE:',data)
		try{ localStorage.setItem('skyrim_alchemy_tool', JSON.stringify(data)); return true; }catch(e){
			console.warn(e);
			console.warn('Try to store without potions map');
		}
		data.potionsMap = null;
		try{ localStorage.setItem('skyrim_alchemy_tool', JSON.stringify(data)); return true; }catch(e){
			console.error(e);
		}
		return false;
	}

	// localStorage detection
	function supportsLocalStorage() {
		return typeof(localStorage)!== 'undefined' && typeof(JSON)!== 'undefined';
	}


	// ==================================================================================================================
	// Potions list functions

	function showPotions(e) {
		var priceDelta = 150; // delta between gold and red mark
		var lowPriotityDelta = 200;
		var inid = $(this).attr('inid');
		var id = ( e && e.data && e.data.id )? e.data.id : (inid)? inid : potionsId;
		var isFull = (( e && e.data && e.data.isFull !== undefined )? e.data.isFull : potionsIsFull )? true : false;
		var ingredient = ingredientsList[id];
		if (!potionsMap[id]) {
			console.warn("Potions list can't be shown for excluded ingredient!");
			return false;
		}
		var best = isFull ? potionsMap[id].bestFull : potionsMap[id].best;
		//console.log(id,e?e.data:'',this)

		// history and buttons
		if (id != potionsId)
			potionsHistory.push(id);
		potionsId = id;
		potionsIsFull = isFull;
		$('#potions_div input.aback').prop('disabled', (potionsHistory.length < 2));
		$('#potions_div input.afull').val(isFull ? 'Фильтр' : 'Все ингредиенты');
		$('#potions_div img.hd_ico').attr('src', isFull ? './files/ico_price_b.png' : './files/ico_price.png');

		// name
		$('#potions_div .base_ingredient_name').html(ingredient.name);

		// ingredient element
		var makeIngredientElement = function(id, potionPrice) {
			var ingredient = ingredientsList[id];
			var best = isFull ? potionsMap[id].bestFull : potionsMap[id].best;
			var price = parseInt(best.price) // ingredient best price
			var cclass = (price > potionPrice)? ((price > potionPrice + priceDelta)? 'red' : 'gold') : ((price == potionPrice)? 'green' : '');
			var name = '<a inid="'+id+'" title="'+price+'" class="'+cclass+'">'+ingredient.name+'</a>';
			return [cclass, name];
		}

		// list of potions
		var $tbody = $('#potions_div table tbody');
		$tbody.children().remove();
	 	var listKeys = Object.keys(best.list).sort( function(a,b){return b-a;} );
		for (var key of listKeys) {
			var price = parseInt(key);
			var mixes = best.list[price];
			// make list of potions with same price
			var tr_red_only = true;
			var potions_list = '';
			mixes.forEach( function(mix) {
				var span_class = 'potion';
				// ingredient 1
				inid = mix[0];
				var [cclass1, name1] = makeIngredientElement(inid, price);
				span_class += ' inid'+inid+' '+cclass1;
				// ingredient 2
				inid = mix[1];
				var [cclass2, name2] = makeIngredientElement(inid, price);
				span_class += ' inid'+inid+' '+cclass2;
				// potion element
				potions_list += '<span class="'+span_class+'">';
				potions_list += name1 + ' + ' + name2;
				potions_list += '</span>';
				if (cclass1 != 'red' && cclass2 != 'red') {
					tr_red_only = false;
				}
			});
			$tbody.append('<tr' + (( tr_red_only || price < lowPriotityDelta )? ' class="lowprio"' : '') + '><td>' + price + '</td><td>' + potions_list + '</td></tr>');
		}

		// ingredient click handler / context menu
		var menu = {'Рецепты':showPotions, 'Исключить':quickFilterAdd, 'В любимые':favoritesAdd, 'Отмена':function(){}};
		if (window.isMobile) {
			$tbody.find('a').off('click').click(menu, showLinkMenu);
		} else {
			$tbody.find('a').off('click').click(showPotions);
			$tbody.find('a').off('contextmenu').on('contextmenu', menu, showLinkMenu);
		}

		// more potions
		if ($tbody.children().size() > 5) {
			var $tr_for_more = $tbody.find('tr.lowprio:gt(3)');
			if ($tr_for_more.size()) {
				$tbody.append('<tr class="showmore"><td></td><td class="pointer" onclick="showMorePotions()"><a>показать еще...</a></td></tr>');
				$tr_for_more.hide();
			}
		}

		// top section ingredient row
		$('#ingredient_name_div table tbody').children().remove();
		var $tr = getRowById(id).clone(true);
		$tr.find('.diveye').remove();
		$('#ingredient_name_div table tbody').append($tr);

		// show and scroll
		$('#potions_div').show();
		window.scrollTo(0,0);
		return false;
	}

	function showMorePotions() {
		var $tbody = $('#potions_div table tbody');
		$tbody.children().show();
		$tbody.find('.showmore').hide();
	}

	function prevPotions() {
		potionsHistory.pop();
		var id = potionsHistory.pop();
		if (id)
			showPotions({data:{id:id}});
	}

	function refreshPotions() {
		if ($('#potions_div').css('display') != 'none')
			showPotions();
	}

	function quickFilterStyleUpdate() {
		var style = '';
		$('#potions_div .potions_quick_filter a').each( function() {
			var id = $(this).attr('inid');
			style += (style?',':'') + '#potions_div .inid'+id;
		});
		$('#potions-filter').html( style + (style?' {display:none}':'') );
	}

	function quickFilterAdd() {
		var id = $(this).attr('inid');
		var ingredient = ingredientsList[id];
		var $a = $('<a inid="'+id+'">'+ingredient.name+'</a>').click(quickFilterRemove);
		$('#potions_div .potions_quick_filter').append($a).show();
		quickFilterStyleUpdate();
	}

	function quickFilterRemove() {
		var id = $(this).attr('inid');
		$('#potions_div .potions_quick_filter a[inid='+id+']').remove();
		if ($('#potions_div .potions_quick_filter a').length == 0) {
			$('#potions_div .potions_quick_filter').hide();
		}
		quickFilterStyleUpdate();
	}


	// ==================================================================================================================
	// Favorite potions functions

	function favoritesAdd(e) {
		var potion = [parseInt(potionsId)];
		$(this).closest('.potion').find('a').each( function() {
			var id = parseInt($(this).attr('inid'));
			if (id)
				potion.push(id);
		});
		if (potion.length == 3)
			favoritePotions.push(potion);
		else
			console.warn("Wrong potion",potion);
	}


	// ==================================================================================================================
	// Draw functions

	function showLinkMenu(e) {
		e.preventDefault();
		var menu = e.data;
		var link = this;
		var pos = $(this).offset();
		var $ul = $('<ul></ul>');
		for (let [name, handler] of Object.entries(menu)) {
			$ul.append( $('<li>'+name+'</li>').click( function() {
				$('.link-menu').remove();
				handler.call(link, e);
			}));
		}
		var $menu = $('<div class="link-menu"></div>');
		$menu.append($ul);
		$menu.css({top:pos.top, left:pos.left});
		$('body').append($menu);
	}

	function prepareIngredientsTable() {
		var $ingredients_tbody = $("table#ingredients_table tbody");
		$ingredients_tbody.children().remove();
		for (var id in potionsMap) {
			var ingredient = ingredientsList[id];
			var $tr = $('<tr origindex="'+id+'"></tr>');
			// filtered
			if (isFilteredIngredient(id))
				$tr.addClass('filtered');
			// name
			var $td1 = $('<td class="name_column"></td>');
			$td1.append($('<a title="'+ingredient.name+'">'+ingredient.name+'</a>').click(id, clickIngredient));
			// eye
			$td1.append($('<div class="diveye" title="'+id+'"><img src="./files/ico_eye.png" /></div>').click({id:id}, showPotions));
			$tr.append($td1);
			// effects
			var $td2 = $('<td class="effects"></td>');
			for (var k=0; k<4; k++) {
				var effect = ingredient.effects[k];
				var price = effectsPrice[effect];
				var title = price ? effect+' | '+price : effect;
				var name = effect;
				if (window.isMobile) {
					name = name.replace('Повышение', 'Повыш.');
					name = name.replace('навыка', 'н-ка');
					name = name.replace('Повреждение', 'Повреж.');
				}
				var $ef_div = $('<div class="effect '+(effectsPositive[effect]?'positive':'negative')+'" title="'+title+'"><a title="'+effect+'">'+name+'</a></div>');
				// price bar
				$ef_div.append('<div class="effectvprice" title="'+price+'" style="height:'+Math.ceil(price/maxEPrice*100)+'%"></div>');
				// click
				$ef_div.find('a').click(clickEffect);
				// warning
				if ($.inArray(effect, effectsWarning) > -1)
					$ef_div.addClass('effect_warning');
				$td2.append($ef_div);
			}
			$tr.append($td2);
			// weight,price
			$tr.append('<td class="weight-place hide-on-mobile">'+ingredient.weight+'</td>');
			$tr.append('<td class="price-place">'+ingredient.price+'</td>');
			//best price
			var best = potionsMap[id].best;
			$tr.append($('<td class="best_price case-on-mobile"><a title="'+makeMixTitle(best.list[best.price])+'">'+(best.price?best.price:'-')+'</a></td>').click({id:id, isFull:false}, showPotions));
			var bestFull = potionsMap[id].bestFull;
			if (bestFull) {
				$tr.append($('<td class="best_price hide-on-mobile"><a title="'+makeMixTitle(bestFull.list[bestFull.price])+'">'+bestFull.price+'</a></td>').click({id:id, isFull:true}, showPotions));
			}
			// insert into table
			$ingredients_tbody.append($tr);
		}
		// update sortable
		$("#ingredients_table").trigger("update");
	}

	// ==================================================================================================================
	// loading functions

	function initAll() {
		// load bar
		$("#alch_div").hide().after('<div id="loading"><div id="progress_bar">loading...</div></div>');
		// iterator
		var iterator = initIterator();
		// step
		var iterator_step = function() {
			var v = iterator.next();
			//console.log(v); // { value:%, done:false/true }
			if (!v.done) {
				$("#progress_bar").html(v.value+'%').css('width',v.value+'%');
				window.setTimeout(iterator_step, 10);
			} else {
				$("#loading").hide();
				$("#alch_div").show();
			}
		}
		// start
		window.setTimeout(iterator_step, 10);
	}

	function* initIterator() {
		// load filtered
		loadFiltered();
		yield 2;

		// id by ingredient
		idByIngredient = {};
		var ing2id = {};
		for (var i in ingredientsList) {
			ing2id[ingredientsList[i].name] = i;
		}
		var ingKeys = Object.keys(ing2id).sort();
		for (var i in ingKeys) {
			idByIngredient[ingKeys[i]] = ing2id[ingKeys[i]];
		}
		yield 4;

		// culc best price
		if (!loadState()) {
			// save and reload filtered
			saveState();
			loadFiltered();

			// prepare index
			prepareIngredientsIndex(ingredientsList);
			yield 6;

			var cnt = Object.keys(ingredientsList).length;
			var k = 0;
			for (var i in ingredientsList) {
				if (!potionsMap[i]) potionsMap[i] = {};
				potionsMap[i].best = makeIngredientBestPrice(i, false);
				potionsMap[i].bestFull = makeIngredientBestPrice(i, true);
				k++;
				yield 6+Math.round(90*k/cnt);
			}

			// save to storage
			saveState();

		} else {
			// prepare index
			yield 10;
			prepareIngredientsIndex(potionsMap);
			yield 90;
		}
		//yield 96;

		// prepare ingredients table
		prepareIngredientsTable();
		yield 98;

		// table header
		var $ingredients_header = $('table#ingredients_table thead tr');
		$('#ingredient_name_div table thead').append($ingredients_header.clone());
		$('#ingredient_filter table thead').append($ingredients_header.clone());

		// make sortable
		$("#ingredients_table").tablesorter({sortList: [[0,0]] });
		yield 99;

		// Adjust effect div
		adjust_effect_width = function() {
			var effect_width = $('div.effect').width();
			var price_width = $('table.ingredients td.price-place').width();
			console.log(effect_width);
			if (effect_width > 0) {
				// add custom style element
				var css = '<style type="text/css">\n';
				css += '.mobile div.effect { width: ' + effect_width + 'px; white-space: nowrap; }\n';
				css += '.mobile .p-mode div.effect { width: ' + (effect_width - price_width) + 'px; white-space: nowrap; }\n';
				css += '</style>';
				$('head').append(css);
			} else {
				window.setTimeout(adjust_effect_width, 500);
			}
		};
		if (window.isMobile) {
			window.setTimeout(adjust_effect_width, 500);
		}

		yield 100;
	}


	// onload
	$(document).ready(function() {

		// mobile behavior
		window.isMobile = window.mobileAndTabletCheck();
		if (window.isMobile) {
			$('html').addClass('mobile');
			var document_width = document.body.offsetWidth;
			//var font_size = document_width / 8 * window.devicePixelRatio;
			var font_size = Math.round( 13 / window.devicePixelRatio * 50 )/10; // px
			$('head').append('<style type="text/css">body, th, td, p, a { font-size:'+font_size+'px; }</style>');
			//$('body').prepend('<p>'+font_size+'px</p>');
		}

		// loading
		initAll();

	});
</script>
</head>
<body>
<!-- -------------------------------- body -------------------------------- -->

<div id="pagemain">
	<div id="wrapper">
		<div id="maincolumn" class="mainstyles">
			<div class="maincontent">

<div id="help_info" style="display:none">
	<div style="float:right; padding:3px 10px"><a onclick="$('#help_info').hide();return false;">(✖ Скрыть)</a></div>
	<h3>Приветствую тебя, алхимик</h3>
	<ul>
		<li><b>Нажми на название ингредиента</b> чтобы начать составлять рецепт.</li>
		<li><b>Нажми на глаз рядом с названием ингредиента</b> чтобы увидеть список рецептов с этим ингредиентом.</li>
		<li><b>Используй фильтр</b> чтобы ограничить использование ингредиентов для составления списка рецептов.</li>
		<li><b>Нажми на название эффекта</b> чтобы увидеть только те ингредиенты, которые содержат этот эффект.</li>
		<li><b>Нажми на заголовок таблицы</b> чтобы отсортировать содержимое.</li>
	</ul>
	<p style="margin-top:20px; padding-left:20px">
		<b>Значения колонок:</b>
	</p>
	<ul style="list-style-type: none;">
		<li><img alt="Weight" src="./files/ico_weight.png"> - Вес / Промежуточная цена зелья при выбранном ингредиенте<br></li>
		<li><img alt="Value" src="./files/ico_gold.png" /> - Цена / Условная цена лучшего рецепта для выбранного ингредиента<br></li>
		<li><img alt="Best" src="./files/ico_price.png" /> - Условная цена лучшего рецепта из отфильтрованных<br></li>
		<li><img alt="Best" src="./files/ico_price_b.png" /> - Условная цена лучшего рецепта из всех ингредиентов<br></li>
	</ul>
</div>

<div id="alch_div">
	<div style="float:right; padding:.1em 1em"><a onclick="$('#help_info').toggle();return false;" style="color:#E8F4F9">(Подсказка)</a></div>

<div id="filtered_show_div">
	<p><input class="abutton" type="button" value="Фильтр" onclick="showFiltered();"></p>
</div>
<div id="filtered_list_div" style="display:none">
	<p><input class="abutton" type="button" value="Отмена" onclick="closeFiltered();"></p>
	<table>
		<thead><tr><th>Имя фильтра</th></tr></thead>
		<tbody><tr><td></td></tr></tbody>
	</table>
</div>
<div id="filtered_div" style="display:none">
	<p>
		<input class="abutton" type="button" value="Отмена" onclick="closeFiltered();">
		<input class="abutton" type="button" value="Ok" onclick="applyFiltered();">
		<input class="abutton" type="button" value="Список" onclick="selectFiltered();">
	</p>
	<table type="N">
		<thead>
			<tr>
				<th>
					Используемые ингредиенты.
	 				<label><input type="checkbox" onclick="toggleAllFiltered(this);"/> отметить все.</label>
				</th>
			</tr>
		</thead>
		<tbody><tr><td class="filter"></td></tr></tbody>
	</table>
	<table type="DG">
		<thead>
			<tr>
				<th>
					<label><input type="checkbox" name="afilter" value="DG" checked onclick="toggleFilteredA(this);"/>
					The Elder Scrolls V: Dawnguard.</label>
				</th>
			</tr>
		</thead>
		<tbody><tr><td class="filter"></td></tr></tbody>
	</table>
	<table type="HF">
		<thead>
			<tr>
				<th>
					<label><input type="checkbox" name="afilter" value="HF" checked onclick="toggleFilteredA(this);"/>
					The Elder Scrolls V: Hearthfire.</label>
				</th>
			</tr>
		</thead>
		<tbody><tr><td class="filter"></td></tr></tbody>
	</table>
	<table type="D">
		<thead>
			<tr>
				<th>
					<label><input type="checkbox" name="afilter" value="D" checked onclick="toggleFilteredA(this);"/>
					The Elder Scrolls V: Dragonborn.</label>
				</th>
			</tr>
		</thead>
		<tbody><tr><td class="filter"></td></tr></tbody>
	</table>
	<p>
		<input class="abutton" type="button" value="Отмена" onclick="closeFiltered();">
		<input class="abutton" type="button" value="Ok" onclick="applyFiltered();">
		<input class="abutton" type="button" value="Список" onclick="selectFiltered();">
	</p>
</div>

<div id="potions_div" style="display:none">
	<div id="ingredient_name_div" style="margin-top: 1.1em;">
		<table class="ingredients">
			<thead></thead>
			<tbody></tbody>
		</table>
	</div>
	<p>
		<input class="abutton aback" type="button" value="&lt; Назад" onclick="prevPotions();">
		<input class="abutton afull" type="button" value="Показать" onclick="showPotions({data:{isFull:!potionsIsFull}});">
		<input class="abutton" type="button" value="Закрыть" onclick="$('#potions_div').hide();">
	</p>
	<table class="no-red">
		<thead>
			<tr>
				<th class="num_column"><img class="hd_ico" alt="Best" src="./files/ico_price.png"></th>
				<th class="ingredients_column">
					<label style="float:right">
					<input type="checkbox" onclick="$(this).closest('table').toggleClass('no-red');"/>красные</label>
					Рецепты на основе ингредиента:
					<i class="base_ingredient_name"></i>
					<fieldset class="potions_quick_filter" style="display:none"><legend>Исключая</legend></fieldset>
				</th>
			</tr>
		</thead>
		<tbody></tbody>
	</table>
	<p>
		<input class="abutton aback" type="button" value="&lt; Назад" onclick="prevPotions();">
		<input class="abutton afull" type="button" value="Показать" onclick="showPotions({data:{isFull:!potionsIsFull}});">
		<input class="abutton" type="button" value="Закрыть" onclick="$('#potions_div').hide();">
	</p>
</div>

<div id="filter_div">
	<div id="all_ingredients" style="display: block;">
		<p>Список ингредиентов.</p>
	</div>

	<div id="ingredient_filter" style="display: none;">
		<p>Список ингредиентов, которые имеют общие эффекты с:</p>
		<table class="ingredients">
			<thead></thead>
			<tbody></tbody>
		</table>
		<p>Совпавшие эффекты выделены <span class="highlighted">жирным</span></p>
		<input class="abutton" type="button" value="Показать все" onclick="showAll();">
	</div>

	<div id="effects_filter" style="display: none;">
		<p>Список ингредиентов которые имеют эффект <a id="effect_name" class="highlighted"></a></p>
		<input class="abutton" type="button" value="Показать все" onclick="showAll();">
	</div>
</div>

<div class="right-float-option"><label><input type="checkbox" id="show_filtered" onclick="$('body').toggleClass('show_filtered');">Отображать отфильтрованные.</label></div>
<div id="ingredients_table_div">
<table class="tablesorter ingredients" id="ingredients_table">
	<thead>
		<tr>
			<th class="name_column">Название</th>
			<th class="effect_column">Эффекты</th>
			<th class="num_column hide-on-mobile"><img alt="Weight" src="./files/ico_weight.png" /></th>
			<th class="num_column"><img alt="Value" src="./files/ico_gold.png" /></th>
			<th class="num_column case-on-mobile"><img alt="Best" src="./files/ico_price.png" /></th>
			<th class="num_column hide-on-mobile"><img alt="Best" src="./files/ico_price_b.png" /></th>
		</tr>
	</thead>
	<tbody></tbody>
</table>
</div>

</div>

			</div>
		</div>
	</div>
</div>

</body>
</html>
